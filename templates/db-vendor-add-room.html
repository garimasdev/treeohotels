{% extends 'db-base.html' %}

{% block title %}Homepage - GoTrip{% endblock %}

{% load static %}

{% block content %}

  <div class="dashboard" data-x="dashboard" data-x-toggle="-is-sidebar-open">
    
    <div class="dashboard__main">
      <div class="dashboard__content bg-light-2">
        <div class="row y-gap-20 justify-between items-end pb-60 lg:pb-40 md:pb-32">
          <div class="col-auto">

            <h1 class="text-30 lh-14 fw-600">Add Room Details</h1>
            <div class="text-15 text-light-1">Lorem ipsum dolor sit amet, consectetur.</div>

          </div>

          <div class="col-auto">

          </div>
        </div>


        <div class="py-30 px-30 rounded-4 bg-white shadow-3">
          <div class="tabs -underline-2 js-tabs">
            <div class="tabs__controls row x-gap-40 y-gap-10 lg:x-gap-20 js-tabs-controls">

              <div class="col-auto">
                <button class="tabs__button text-18 lg:text-16 text-light-1 fw-500 pb-5 lg:pb-0 js-tabs-button is-tab-el-active" data-tab-target=".-tab-item-1">1. Content</button>
              </div>

              <div class="col-auto">
                <button class="tabs__button text-18 lg:text-16 text-light-1 fw-500 pb-5 lg:pb-0 js-tabs-button " data-tab-target=".-tab-item-4">2. Facilities</button>
              </div>

            </div>

            <div class="tabs__content pt-30 js-tabs-content">

            <!-- add Room form -->
            <form id="RoomForm" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="tabs__pane -tab-item-1 is-tab-el-active">
                <div class="col-xl-10" id="room-form-container">
                <div class="room-form mt-20">
                    <div class="fw-500 mb-20">Room Details</div>

                    <div class="overflow-scroll scroll-bar-1">
                    <table class="table-5 -border-bottom col-12">
                        <thead class="bg-light-2">
                        <tr>
                            <th>Title</th>
                            <th>Content</th>
                            <th></th>
                        </tr>
                        </thead>
                        <tbody>

                        <tr>
                            <td class="col-5">
                            <div class="form-input ">
                                <input type="text" name="room_type" required>
                                <label class="lh-1 text-16 text-light-1">Room category</label>
                            </div>
                            </td>
                            <td class="col-5">
                            <div class="form-input ">
                                <input type="number" name="room_price" required>
                                <label class="lh-1 text-16 text-light-1">Room price</label>
                            </div>
                            </td>
                        </tr>

                        <tr>
                            <td class="col-5">
                            <div class="form-input ">
                                <input type="number" name="available_room" required>
                                <label class="lh-1 text-16 text-light-1">Room Availability</label>
                            </div>
                            </td>
                            <td class="col-5">
                            <div class="form-input ">
                                <input type="number" name="sleeps" required>
                                <label class="lh-1 text-16 text-light-1">Room Sleeps</label>
                            </div>
                            </td>
                        </tr>

                        </tbody>
                    </table>
                    </div>

                    <div class="mt-30">
                    <div class="fw-500">Room Images</div>
                    <input type="file" name="room_images" multiple accept="image/*">

                    <div class="row x-gap-20 y-gap-20 pt-15">
                        <div class="col-auto">
                        <div class="w-200">
                            <div class="d-flex ratio ratio-1:1">
                            <div class="flex-center flex-column text-center bg-blue-2 h-full w-1/1 absolute rounded-4 border-type-1">
                                <div class="icon-upload-file text-40 text-blue-1 mb-10"></div>
                                <div class="text-blue-1 fw-500">Upload Images</div>
                            </div>
                            </div>
                            <div class="text-center mt-10 text-14 text-light-1">PNG or JPG no bigger than 800px wide and tall.</div>
                        </div>
                        </div>
                    </div>
                    </div>

                    <div class="d-flex justify-end">
                    <button class="button -md -blue-1 bg-blue-1-05 text-blue-1 mt-0 add-room-btn">Add Room</button>
                    </div>
                    <div class="d-flex justify-end">
                    <button class="button -md -red-1 bg-blue-1-05 text-blue-1 mr-150 delete-room-btn" style="margin-top:-48px">Delete Room</button>
                    </div>
                </div>
                </div>

                <div class="d-inline-block pt-30">
                <button type="submit" class="button h-50 px-24 -dark-1 bg-blue-1 text-white">
                    Save Changes <div class="icon-arrow-top-right ml-15"></div>
                </button>
                </div>
            </div>
            </form>
            

            <!-- room ameneties -->
            <form id='hotelService' method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="tabs__pane -tab-item-4">
                <div class="col-xl-9 col-lg-11">
                    <div class="row x-gap-100 y-gap-15">
                        <div class="col-12">
                            <div class="text-18 fw-500">Room Amenities</div>
                        </div>
                        <input type="hidden" id="room-id" value="{{ room.id }}">
                        <div id="amenities-container" style="display: contents;"></div>
                    </div>
                </div>
                    
                <div class="d-inline-block mt-30">
                    <button type="submit" class="button h-50 px-24 -dark-1 bg-blue-1 text-white">
                        Save Changes <div class="icon-arrow-top-right ml-15"></div>
                    </button>
                </div>
            </div>
            
            </form>  
              
            </div>
          </div>
      </div>


        <footer class="footer -dashboard mt-60">
          <div class="footer__row row y-gap-10 items-center justify-between">
            <div class="col-auto">
              <div class="row y-gap-20 items-center">
                <div class="col-auto">
                  <div class="text-14 lh-14 mr-30">Â© 2022 GoTrip LLC All rights reserved.</div>
                </div>

                <div class="col-auto">
                  <div class="row x-gap-20 y-gap-10 items-center text-14">
                    <div class="col-auto">
                      <a href="db-vendor-add-hotel.html#" class="text-13 lh-1">Privacy</a>
                    </div>
                    <div class="col-auto">
                      <a href="db-vendor-add-hotel.html#" class="text-13 lh-1">Terms</a>
                    </div>
                    <div class="col-auto">
                      <a href="db-vendor-add-hotel.html#" class="text-13 lh-1">Site Map</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-auto">
              <div class="d-flex x-gap-5 y-gap-5 items-center">
                <button class="text-14 fw-500 underline">English (US)</button>
                <button class="text-14 fw-500 underline">USD</button>
              </div>
            </div>
          </div>
        </footer>
      </div>
    </div>

  </div>

{% endblock %}

{% block javascript %}
<!-- add & delete room -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
      // Function to clone the room form
      const roomFormContainer = document.getElementById('room-form-container');
      
      document.querySelector('.add-room-btn').addEventListener('click', function() {
          // Clone the existing room form and reset input values
          const newRoomForm = roomFormContainer.querySelector('.room-form').cloneNode(true);

          // Reset all form fields in the cloned room
          const inputs = newRoomForm.querySelectorAll('input');
          inputs.forEach(input => input.value = '');

          // Append the new room form to the container
          roomFormContainer.appendChild(newRoomForm);
      });

      // Function to delete the room form
      roomFormContainer.addEventListener('click', function(event) {
          if (event.target.classList.contains('delete-room-btn')) {
              const roomForm = event.target.closest('.room-form');
              if (roomForm && roomFormContainer.children.length > 1) {
                  roomFormContainer.removeChild(roomForm);  // Remove the room form
              }
          }
      });
  });
</script>

<!-- add room details -->
<script>
    document.getElementById("RoomForm").addEventListener("submit", function (event) {
    event.preventDefault();

    let formData = new FormData(this);

    fetch('{% url "dashboard:add-room" %}', {
        method: "POST",
        headers: {
            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.room_id) {
            alert("Room added successfully!");
            document.getElementById("room-id").value = data.room_id; // Store room_id for amenities
        } else {
            alert("Error: " + data.error);
        }
    })
    .catch(error => console.error("Error:", error));
});

</script>

<!-- fetch the ameneties and get the ameneties -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch('{% url "dashboard:get_amenities" %}')
            .then(response => response.json())
            .then(data => {
                let container = document.getElementById("amenities-container");
                container.innerHTML = ""; // Clear existing content
    
                Object.keys(data.amenities).forEach(category => {
                    let categoryHeader = `<div class="col-12 pt-20">
                        <div class="text-18 fw-500">${category}</div>
                    </div>`;
                    container.innerHTML += categoryHeader;
    
                    data.amenities[category].forEach(amenity => {
                        let amenityHTML = `<div class="col-lg-3 col-sm-6">
                            <div class="row y-gap-15">
                                <div class="col-12">
                                    <div class="d-flex items-center">
                                        <div class="form-checkbox">
                                            <input type="checkbox" name="amenity" value="${amenity.id}">
                                            <div class="form-checkbox__mark">
                                                <div class="form-checkbox__icon icon-check"></div>
                                            </div>
                                        </div>
                                        <div class="text-15 lh-11 ml-10">${amenity.name}</div>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                        container.innerHTML += amenityHTML;
                    });
                });
            })
            .catch(error => console.error("Error fetching amenities:", error));
    });


    document.getElementById("hotelService").addEventListener("submit", function (event) {
    event.preventDefault();

    let roomId = document.getElementById("room-id").value;
    console.log(roomId);

    let selectedAmenities = [];
    document.querySelectorAll('input[name="amenity"]:checked').forEach(checkbox => {
        selectedAmenities.push(parseInt(checkbox.value));
    });

    fetch('{% url "dashboard:save_room_amenities" %}', {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({ room_id: roomId, amenities: selectedAmenities })
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message);
    })
    .catch(error => console.error("Error saving amenities:", error));
});


</script>

{% endblock %}